## Sequential Thinking MCP 使用规则

Thinking MCP 提供结构化的思维链分析，支持动态调整、修正和分支探索。

### 强制使用场景

以下情况**必须**使用 Sequential Thinking 进行深度分析：

1. **架构设计决策**
   - 选择技术栈或框架
   - 设计模块间的交互方式
   - 数据结构和算法选择

2. **复杂 Bug 调试**
   - 难以复现的问题
   - 涉及多个组件的故障
   - 性能问题的根因分析

3. **安全性评估**
   - 代码安全审查
   - 权限和访问控制设计
   - 输入验证策略

4. **多方案对比**
   - 存在多种实现方式
   - 需要权衡 trade-offs
   - 用户需要决策支持

5. **重构策略**
   - 大规模代码重构
   - API 设计变更
   - 性能优化方案

### 推荐使用场景

1. **复杂算法实现前** - 理清思路避免返工
2. **代码审查** - 深入分析潜在问题
3. **影响评估** - 预测修改的副作用
4. **边界情况设计** - 系统性考虑异常情况
5. **学习新概念** - 构建知识框架

### 思考深度指南

| 任务复杂度 | 建议 totalThoughts | 示例 |
|-----------|-------------------|------|
| 简单分析 | 3-4 | 单函数优化、简单 bug 定位 |
| 中等复杂 | 5-7 | 模块设计、多步骤实现规划 |
| 高度复杂 | 8-12 | 架构决策、跨系统影响分析 |
| 探索性 | 动态调整 | 研究性问题、未知领域 |

**关键**：`totalThoughts` 是估计值，可随时调整。发现需要更多分析时设置 `needsMoreThoughts: true`。

### 参数使用指南

**基础参数**：
```
thought: 当前思考步骤的内容
thoughtNumber: 当前步骤编号（从1开始）
totalThoughts: 预计总步骤（可调整）
nextThoughtNeeded: 是否需要继续思考
```

**修正机制**（发现之前的分析有误时）：
```
isRevision: true
revisesThought: 被修正的步骤编号
```

**分支探索**（需要探索替代方案时）：
```
branchFromThought: 分支起点的步骤编号
branchId: 分支标识符（如 "alternative-a"）
```

### 思考结构模板

**标准分析流程**：
```
Step 1: 问题定义和范围界定
Step 2: 收集相关信息和约束条件
Step 3: 提出初步假设/方案
Step 4: 验证假设/评估方案
Step 5: 得出结论和行动建议
```

**调试分析流程**：
```
Step 1: 症状描述和错误信息分析
Step 2: 可能原因列举
Step 3: 逐一排查（可能需要多步）
Step N-1: 根因确认
Step N: 修复方案
```

**架构决策流程**：
```
Step 1: 需求和约束分析
Step 2: 列举候选方案
Step 3-N: 逐个评估（优缺点、trade-offs）
Step N+1: 综合对比
Step N+2: 推荐方案及理由
```

### 与其他工具的协同

**Thinking + EnterPlanMode**：
```
1. Thinking: 分析问题，形成初步方案
2. EnterPlanMode: 详细规划实现步骤
3. 执行实现
```

**Thinking + Context7**：
```
1. Thinking: 确定需要学习的库/概念
2. Context7: 获取相关文档
3. Thinking: 整合知识，规划应用方式
```

**Thinking + Search_code**：
```
1. Search_code: 了解现有实现
2. Thinking: 分析优缺点，提出改进方案
3. 执行修改
```

**Thinking + TodoWrite**：
```
1. Thinking: 深度分析，分解任务
2. TodoWrite: 将分析结果转化为可跟踪的任务列表
3. 逐步执行
```

### 不使用的场景

- 简单的单步操作（读文件、运行命令）
- 明确的、无歧义的任务
- 用户已给出详细的实现步骤
- 纯粹的信息查询（用其他工具更高效）

### 质量检查清单

每次思考结束前确认：
- [ ] 是否考虑了所有相关约束？
- [ ] 是否存在未验证的假设？
- [ ] 结论是否有充分的依据？
- [ ] 是否需要探索替代方案？
- [ ] 是否可以得出可操作的下一步？

### 示例：何时调整思考步骤

**扩展思考**（`needsMoreThoughts: true`）：
- 发现问题比预期复杂
- 初步方案存在缺陷需要重新分析
- 出现新的约束条件

**修正思考**（`isRevision: true`）：
- 发现之前的假设错误
- 获得新信息推翻之前的结论
- 意识到遗漏了关键因素

**分支思考**（`branchFromThought`）：
- 存在互斥的多个方案
- 需要对比不同技术路线
- 用户要求探索替代选项
